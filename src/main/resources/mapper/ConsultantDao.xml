<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.dao.ConsultantDao">
    <select id="findAllConsultantByAuthorityNoName" resultType="com.example.demo.domain.Consultant">
        select * from worker where authority = "Counselor" limit #{pageNum}, #{pageSize}
    </select>

    <select id="findAllConsultantByAuthority" resultType="com.example.demo.domain.Consultant">
        select * from worker where authority = "Conselor" and name = #{name} limit #{pageNum}, #{pageSize}
    </select>

    <select id="findAllConsultantCountNoName" resultType="long">
        select count(*) from worker where authority = "Counselor"
    </select>

    <select id="findAllCountCount" resultType="long">
        select count(1) from worker where name = #{search} and authority = "Counselor"
    </select>

    <update id="bannedCounselor" parameterType="String">
        update worker set status = "banned" where username = #{username}
    </update>

    <update id="enableCounselor">
        update worker set status = "normal" where username = #{username}
    </update>

    <select id="selectCounselor" resultType="com.example.demo.domain.Consultant" parameterType="String">
        select * from worker where username = #{username}
    </select>

    <update id="updateCounselorByUsername" parameterType="com.example.demo.domain.Consultant">
        update worker <set>name = #{name}, gender = #{gender}, password = #{password}, pno = #{pno}, email = #{email}, title = #{title}, workunit = #{workunit}</set> where username = #{username}
    </update>

    <select id="findAllConIsOnline" resultType="com.example.demo.domain.Consultant">
        select * from worker  where authority = "Counselor" and is_online = "1" and current &lt; 15
    </select>

    <select id="findAllConIsOnlineCount" resultType="long">
        select count(1) from worker where authority = "Counselor" and is_online = "1"
    </select>

    <update id="updateConIsBusy">
        update worker set is_Busy = "busy" where username = #{username}
    </update>

    <update id="subCurrent">
        update worker set current = current - 1 where username = #{username}
    </update>

    <update id="updateConIsFree">
        update worker set is_Busy = "free" where username = #{username}
    </update>

    <select id="findName" parameterType="String" resultType="String">
        select name from worker where username = #{username} and authority = "Counselor"
    </select>

    <!--<select id="findAllCounselor" resultType="com.example.demo.domain.Consultant">
        select * from worker where authority = "Counselor"
    </select>-->

    <select id="findByUsername" resultType="String">
        select name from worker where username = #{username}
    </select>

    <select id="findAllByIsBusyAndAuthority" resultType="com.example.demo.domain.Consultant">
        select * from worker where is_online = "1" and authority = "Counselor" limit #{pageNum}, #{pageSize}
    </select>

    <select id="isBusyCount" resultType="int">
        select count(1) from worker where authority = "Counselor" and is_Busy = "busy"
    </select>

    <!--统计正在进行的咨询数量-->
    <select id="consultCount">
        select sum(current) from worker where authority = "Counselor" and is_online = "1"
    </select>

    <!--督导查看在线的咨询师-->
    <select id="findAllBindIsOnline" resultType="com.example.demo.domain.Consultant">
        select * from worker where bind_username = #{supervisorUsername} and is_online = "1" limit #{pageNum}, #{pageSize}
    </select>

    <update id="addCurrent">
        update worker set current = current + 1 where username = #{username}
    </update>
    <!--删除咨询师-->
    <delete id="deleteCounselor">
        delete from worker where username = #{username}
    </delete>
    <!--绑定-->
    <update id="bindSupForCounselor">
        update worker set bind_name = #{name}, bind_username = #{supervisorUsername} where username = #{counselorUsername}
    </update>
    <!--一个咨询师现在正在进行的咨询数量-->
    <select id="currentCon" resultType="int">
        select current from worker where username = #{username}
    </select>
    <!--返回忙闲状态-->
    <select id="findStatus" resultType="String">
        select is_Busy from worker where username = #{username}
    </select>
    <!--结束咨询时咨询师今日咨询数量加一-->
    <update id="addOrder">
        update worker set orderNumber = orderNumber + 1 where username = #{username}
    </update>
    <!--在线咨询师数量-->
    <select id="onLineConCount" resultType="long">
        select count(*) from worker where is_online = "1" and authority = "Counselor" and status = "normal"
    </select>
    <!--咨询师个人首页-->
    <!--平均评分-->
    <select id="avgLevel" resultType="String">
        select avg(level) from record where c_username = #{username}
    </select>
    <!--总咨询数-->
    <select id="totalCount" resultType="int">
        select totalOrder from worker where username = #{username}
    </select>
    <!--正在进行的咨询数量-->
    <select id="currentCount" resultType="int">
        select current from worker where username = #{username}
    </select>
    <!--更新某一位咨询师的总咨询数-->
    <update id="updatetotalOrder">
        update worker set totalOrder = totalOrder + 1 where username = #{username}
    </update>

</mapper>